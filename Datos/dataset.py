# -*- coding: utf-8 -*-
"""Dataset.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1sZJhigwA6VaIJPMKrUbjixeTd9Op6PDe
"""

!apt-get install openjdk-8-jdk-headless -qq > /dev/null
!wget -q https://archive.apache.org/dist/spark/spark-3.3.2/spark-3.3.2-bin-hadoop3.tgz
!tar xf spark-3.3.2-bin-hadoop3.tgz
!pip install -q findspark

import os
os.environ["JAVA_HOME"] = "/usr/lib/jvm/java-8-openjdk-amd64"
os.environ["SPARK_HOME"] = "/content/spark-3.3.2-bin-hadoop3"

import findspark
findspark.init()

from pyspark.sql import SparkSession

spark = SparkSession.builder \
    .appName("LichessAnalysis") \
    .getOrCreate()

spark

input_path = "/content/drive/MyDrive/Lichess_2013_2014_Complete.csv"

df = spark.read.csv(input_path, header=True, inferSchema=True)

df.show(5)

df.printSchema()
df.columns

df.groupBy("Winner").count().show()

white_win = df.filter(df["Winner"] == "White")
white_win.count()

from pyspark.sql import functions as F

df.select(
    F.avg("WhiteElo").alias("avg_WhiteElo"),
    F.avg("BlackElo").alias("avg_BlackElo")
).show()

df.agg({"Number_of_Moves": "avg"}).show()